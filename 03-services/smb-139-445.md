## NETEXEC (nxc)

```bash
# Initial Scan / Banner
sudo nxc smb $ip

# Check Shares
sudo nxc smb $ip --shares

# Check Shares - Null Authentication
sudo nxc smb $ip --shares -u '' -p ''

# Check Shares - Anonymous / Guest
sudo nxc smb $ip --shares -u 'anonymous' -p ''
sudo nxc smb $ip --shares -u 'guest' -p ''

# Authenticated Shares
sudo nxc smb $ip --shares -u 'user' -p 'password'

# Local Auth
sudo nxc smb $ip --shares -u 'user' -p 'password' --local-auth

# Different Port
sudo nxc smb $ip --port 36445

# List Users
sudo nxc smb $ip -u 'anonymous' -p '' --users

# RID Brute
sudo nxc smb $ip -u 'anonymous' -p '' --rid-brute | tee raw-rid
grep "SidTypeUser" raw-rid | awk -F'\\\\' '{print $2}' | awk '{print $1}' > usernames

# Password Bruteforce
sudo nxc smb $ip --shares -u ./users -p ./passwords --continue-on-success

# Spider Share
sudo nxc smb $ip -u 'anonymous' -p '' --spider SHARENAME --regex .

# Download File
sudo nxc smb $ip -u 'anonymous' -p '' --share SHARENAME --get-file /remote/file /local/file

# Dump SAM Hashes
sudo nxc smb $ip -u 'administrator' -p 'password123' --sam

# Dump LSA Secrets
sudo nxc smb $ip -u 'administrator' -p 'password123' --lsa

# Dump NTDS
sudo nxc smb $ip -u 'administrator' -p 'password123' --ntds

# Logged On Users
sudo nxc smb $ip -u 'administrator' -p 'password123' --loggedon-users
```

## SMBCLIENT

```bash
# List Shares
sudo smbclient -L $ip
sudo smbclient -L //$ip/
sudo smbclient -L \\\\$ip\\

# Null Authentication
sudo smbclient -U '' -L //$ip/
sudo smbclient -U '.' -L //$ip/

# With Credentials
sudo smbclient -L //$ip/ -U username%password

# Access Share
sudo smbclient //$ip/SHARE/
sudo smbclient //$ip/share$ -U username%password

# Download All Files (after connecting)
prompt off
recurse on
mget *
```

## CRACKMAPEXEC

```bash
# Initial Scan
sudo crackmapexec smb $ip

# Check Shares
sudo crackmapexec smb $ip --shares

# Null Auth
sudo crackmapexec smb $ip --shares -u '' -p ''

# Anonymous Auth
sudo crackmapexec smb $ip --shares -u 'anonymous' -p ''

# With Credentials
sudo crackmapexec smb $ip --shares -u 'user' -p 'password'

# Local Auth
sudo crackmapexec smb $ip --shares -u 'user' -p 'password' --local-auth
```

## NMAP

```bash
# Enumerate Shares & Users
sudo nmap -p 139,445 --script=smb-enum-shares,smb-enum-users $ip

# Safe Scripts
sudo nmap --script "safe or smb-enum-*" -p 445 $ip -oN nmap/smb-safe

# SMB Vulnerability Scan
sudo nmap --script smb-vuln* -p 139,445 -oN nmap/smb-vuln $ip
```

## SMBMAP

```bash
# Initial Scan
sudo smbmap -H $ip

# Recursive Scan
sudo smbmap -H $ip -R --depth 5

# With Port
sudo smbmap -H $ip -R --depth 5 -P 139

# With Credentials
sudo smbmap -H $ip -d domain -u user -p password

# Download Share Content
smbmap -u null -p null -H $ip -s SHARENAME$ -R
```

## ENUM4LINUX

```bash
# Anonymous Enumeration
sudo enum4linux -a $ip | tee scan/enum4linux.txt

# Authenticated Enumeration
sudo enum4linux -u username -p password -a $ip

# Users
sudo enum4linux -u username -p password -U $ip

# Groups
sudo enum4linux -u username -p password -G $ip

# Password Policy
sudo enum4linux -u username -p password -P $ip
```

## ENUM4LINUX-NG

```bash
sudo enum4linux-ng $ip | tee scan/enum4linux-ng.txt
sudo enum4linux-ng $ip -oY scan/enum4linux-ng
```

## Mount SMB Share (CIFS)

```bash
# Create Mount Point
sudo mkdir /mnt/share

# Mount Anonymous
sudo mount -t cifs //$ip/share /mnt/share

# Mount With Credentials
sudo mount -t cifs -o "username=user,password=password" //$ip/share /mnt/share

# Domain Mount
sudo mount -t cifs -o "username=user,password=password,domain=DOMAIN" //$ip/share /mnt/share

# List Contents
ls -laR /mnt/share
```

## View Share Permissions

```bash
# Single Folder
sudo smbcacls --no-pass //$ip/ShareName Folder

# All Folders
for i in $(ls /mnt/share); do echo "[*] $i"; sudo smbcacls --no-pass //$ip/ShareName "$i"; echo; done
```

## SMBPASSWD

```bash
# Change Password (Requires Old Password)
sudo smbpasswd -U username -r $ip
```

## Fix SMB Protocol (Port Forwarding Issues)

```bash
# Edit SMB Config
sudo nano /etc/samba/smb.conf

# Add:
min protocol = SMB2

# Restart Service
sudo /etc/init.d/smbd restart
```
